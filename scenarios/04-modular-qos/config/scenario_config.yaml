# Scenario 04: Modular QoS Configuration
# This is the single source of truth for all scenario parameters

scenario:
  name: "04-modular-qos"
  description: "Modular SDN-based QoS for IoT data prioritization"
  version: "2.0"

network:
  bandwidth_mbps: 1  # Link bandwidth (1 Mbps creates good congestion)
  openflow_version: "OpenFlow13"
  controller:
    ip: "127.0.0.1"
    port: 6633

  topology:
    type: "hierarchical"  # 3-layer hierarchy
    core_switches: [1]
    agg_switches: [2, 3]
    edge_switches: [4, 5, 6, 7]

  addressing:
    broker_ip: "10.0.0.1"
    subnet_mask: "/16"
    floor1_subnet: "10.0.1.0/24"
    floor2_subnet: "10.0.2.0/24"

mqtt:
  port: 1883
  topic: "iot/data"
  message_rate: 50  # Messages per second per publisher (creates 80% utilization)
  message_size: 250  # Average message size in bytes
  qos: 1  # MQTT QoS level

  publishers:
    total: 8
    anomaly: 4  # Odd IPs: .1, .3
    normal: 4   # Even IPs: .2, .4

qos:
  # Queue 1: High Priority (Anomaly traffic)
  queue_high:
    id: 1
    min_bandwidth_percent: 70  # 70% guaranteed
    max_bandwidth_percent: 100  # Can use up to 100%
    priority: 20  # OpenFlow flow priority
    description: "High priority queue for anomaly/critical data"

  # Queue 2: Low Priority (Normal traffic)
  queue_low:
    id: 2
    min_bandwidth_percent: 30  # 30% guaranteed
    max_bandwidth_percent: 50  # Limited to 50% max
    priority: 15  # OpenFlow flow priority
    description: "Low priority queue for normal data"

  # Base flow priorities
  base_flows:
    arp_priority: 100
    icmp_priority: 90
    table_miss_priority: 0

  # Classification rules
  classification:
    method: "ip_based"  # Classify by IP address
    rule: "odd_even"     # Odd IPs = anomaly, Even = normal

timing:
  network_stabilization: 5  # Seconds to wait after network start
  broker_startup: 2
  subscriber_startup: 2
  publisher_stagger: 0.5  # Delay between starting publishers
  flow_idle_timeout: 30  # Seconds before flow expires
  flow_hard_timeout: 0   # 0 = no hard timeout

paths:
  project_root: "/home/mqtt-sdn"
  mqtt_dir: "shared/mqtt"
  log_dir: "logs"
  results_dir: "results/04-modular-qos"
  config_dir: "shared/config"

logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file_prefix: "scenario04"

validation:
  # Auto-validate that settings will create proper congestion
  min_utilization: 70  # Minimum % utilization for priority to be visible
  max_utilization: 95  # Maximum % to avoid packet loss

  # Calculate expected utilization
  # Formula: (publishers × msg_rate × msg_size × 8) / (bandwidth_mbps × 1_000_000)
  # Example: (8 × 50 × 250 × 8) / (1 × 1_000_000) = 80% ✅
